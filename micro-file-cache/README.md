# micro-file-cache

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ (TTL).

## –û–ø–∏—Å–∞–Ω–∏–µ

`micro-file-cache` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã, —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è –∏—Ö —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –º–∏–Ω—É—Ç–∞—Ö, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã. –°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ Health check endpoint
- ‚úÖ Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MIME —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫

- **Node.js** - —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **TypeScript** - —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **NestJS** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **Fastify** - HTTP –∞–¥–∞–ø—Ç–µ—Ä (–≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

- **fs-extra** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- **file-type** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MIME —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤
- **dayjs** - —É–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º
- **supertest** - E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoints
- **multer** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- **@nestjs/schedule** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 22 LTS
- pnpm (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ npm
- Docker (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone <repository-url>
cd micro-file-cache
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pnpm install
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
cp env.dev .env

# –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ .env –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞
cp env.example .env
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–∞–π–ª–µ [docs/ENV_SETUP.md](docs/ENV_SETUP.md).

üìñ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**: –°–º. [docs/QUICK_START.md](docs/QUICK_START.md) –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

üìö **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –°–º. [docs/USAGE_EXAMPLES.md](docs/USAGE_EXAMPLES.md) –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
pnpm run start:dev
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000`

### Docker

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t micro-file-cache .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 3000:3000 \
  -e STORAGE_DIR=/app/storage \
  -e DATA_DIR=/app/data \
  -v file-storage:/app/storage \
  -v file-data:/app/data \
  micro-file-cache
```

### Docker Compose

```bash
docker-compose up -d
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è         | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                            | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
| ------------------ | --------------------------------------- | --------------------------------------------- |
| `NODE_ENV`         | `development`                           | –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è                       |
| `LISTEN_HOST`      | `localhost`                             | –•–æ—Å—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞                         |
| `LISTEN_PORT`      | `3000`                                  | –ü–æ—Ä—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞                         |
| `AUTH_TOKEN`       | -                                       | Bearer —Ç–æ–∫–µ–Ω –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `STORAGE_DIR`      | `../test-data/micro-file-cache/storage` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤                |
| `DATA_DIR`         | `../test-data/micro-file-cache/data`    | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö                     |
| `MAX_FILE_SIZE_MB` | `100`                                   | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö        |
| `MAX_TTL_MIN`      | `60`                                    | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π TTL –≤ –º–∏–Ω—É—Ç–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60)  |
| `CLEANUP_CRON`     | `0 */10 * * * *`                        | Cron –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)  |

### –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞

```bash
NODE_ENV=production
LISTEN_HOST=0.0.0.0
LISTEN_PORT=3000
AUTH_TOKEN=your-secret-token
STORAGE_DIR=/app/storage
DATA_DIR=/app/data
MAX_FILE_SIZE_MB=100
MAX_TTL_MIN=60
CLEANUP_CRON=0 */10 * * * *
```

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∑–∞—â–∏—â–µ–Ω Bearer —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º endpoints –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`:

```bash
curl -H "Authorization: Bearer your-token" http://localhost:3000/api/v1/files
```

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**

- `/api/v1/health` - –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

- `AUTH_ENABLED=true` - –≤–∫–ª—é—á–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- `AUTH_SECRET_KEY=your-secret-key` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–≤ production —Ä–µ–∂–∏–º–µ –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

#### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞

```http
POST /api/v1/files
Content-Type: multipart/form-data

file: <file>
ttlMinutes: <number>
```

**–ü—Ä–∏–º–µ—Ä:**

```bash
curl -H "Authorization: Bearer your-secret-token" \
  -X POST http://localhost:3000/api/v1/files \
  -F "file=@document.pdf" \
  -F "ttlMinutes=60"
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "url": "http://localhost:3000/api/v1/files/550e8400-e29b-41d4-a716-446655440000/download",
    "originalName": "document.pdf",
    "size": 1024000,
    "mimeType": "application/pdf",
    "uploadedAt": "2024-01-15T10:30:00.000Z",
    "expiresAt": "2024-01-15T11:30:00.000Z",
    "ttlMinutes": 60,
    "isDuplicate": false
  }
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ

```http
GET /api/v1/files/:id
```

#### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞

```http
GET /api/v1/files/:id/download
```

#### –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

```http
DELETE /api/v1/files/:id
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

```http
GET /api/v1/health
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "uptime": 3600,
    "version": "1.0.0",
    "environment": "development",
    "storage": {
      "totalFiles": 15,
      "totalSize": 52428800,
      "availableSpace": 1073741824
    },
    "cleanup": {
      "lastRun": "2024-01-15T10:30:00.000Z",
      "nextRun": "2024-01-15T10:31:00.000Z",
      "filesDeleted": 3
    }
  }
}
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: 100MB (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MAX_FILE_SIZE_MB`)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π TTL**: 60 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MAX_TTL_MIN`)
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π TTL**: 1 –º–∏–Ω—É—Ç–∞ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞)
- **–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤**: –ª—é–±—ã–µ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### JavaScript/TypeScript

```typescript
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
async function uploadFile(file: File, ttlMinutes: number, token: string) {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('ttlMinutes', ttlMinutes.toString());

  const response = await fetch('/api/v1/files', {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${token}`,
    },
    body: formData,
  });

  return response.json();
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
function downloadFile(id: string, filename: string) {
  const link = document.createElement('a');
  link.href = `/api/v1/files/${id}/download`;
  link.download = filename;
  link.click();
}
```

### Python

```python
import requests

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
def upload_file(file_path: str, ttl_minutes: int, token: str):
    headers = {'Authorization': f'Bearer {token}'}
    with open(file_path, 'rb') as f:
        files = {'file': f}
        data = {'ttlMinutes': ttl_minutes}
        response = requests.post('http://localhost:3000/api/v1/files',
                               files=files, data=data, headers=headers)
    return response.json()

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
def download_file(file_id: str, save_path: str, token: str):
    headers = {'Authorization': f'Bearer {token}'}
    response = requests.get(f'http://localhost:3000/api/v1/files/{file_id}/download', headers=headers)
    with open(save_path, 'wb') as f:
        f.write(response.content)
```

### cURL

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
curl -H "Authorization: Bearer your-secret-token" \
  -X POST http://localhost:3000/api/v1/files \
  -F "file=@document.pdf" \
  -F "ttlMinutes=60"

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
curl -H "Authorization: Bearer your-secret-token" \
  http://localhost:3000/api/v1/files/550e8400-e29b-41d4-a716-446655440000

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
curl -H "Authorization: Bearer your-secret-token" \
  -O http://localhost:3000/api/v1/files/550e8400-e29b-41d4-a716-446655440000/download

# –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
curl -H "Authorization: Bearer your-secret-token" \
  -X DELETE http://localhost:3000/api/v1/files/550e8400-e29b-41d4-a716-446655440000
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
micro-file-cache/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts              # –ö–æ—Ä–Ω–µ–≤–æ–π –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ files/                 # –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage/               # –ú–æ–¥—É–ª—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cleanup/               # –ú–æ–¥—É–ª—å –æ—á–∏—Å—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ common/                    # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ config/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ test/                          # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docs/                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ package.json
```

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pnpm run start:dev

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
pnpm run build

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pnpm run test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pnpm run test:cov

# E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pnpm run test:e2e

# –õ–∏–Ω—Ç–∏–Ω–≥
pnpm run lint

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
pnpm run format
```

### Docker

```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º —Å Docker Compose
docker-compose up -d

# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
docker-compose --profile dev up -d micro-file-cache-dev

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Docker: [DOCKER_USAGE.md](./DOCKER_USAGE.md)

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–∫–µ—Ç `file-type` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è MIME —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É, –∞ –Ω–µ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é:

```typescript
import { fileTypeFromBuffer } from 'file-type';

const mimeType = await fileTypeFromBuffer(buffer);
// –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω
```

#### –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `fs-extra` —É–ø—Ä–æ—â–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π:

```typescript
import * as fs from 'fs-extra';

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
await fs.ensureDir(path);

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
await fs.remove(filePath);
```

#### –£–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏

–ü–∞–∫–µ—Ç `dayjs` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç—É—é —Ä–∞–±–æ—Ç—É —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º:

```typescript
import dayjs from 'dayjs';

const expiration = dayjs().add(ttlMinutes, 'minute').utc().toISOString();
const isExpired = dayjs().utc().isAfter(dayjs(expiresAt).utc());
```

#### –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

`supertest` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–µ HTTP –∑–∞–ø—Ä–æ—Å—ã:

```typescript
import * as request from 'supertest';

await request(app.getHttpServer())
  .post('/api/v1/files')
  .attach('file', buffer, 'test.txt')
  .field('ttlMinutes', '60')
  .expect(201);
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
pnpm run test

# E2E —Ç–µ—Å—Ç—ã
pnpm run test:e2e

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pnpm run test:cov
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç endpoint `/api/v1/health` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
- –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –ª–æ–≥–∏—Ä—É–µ—Ç:

- –ó–∞–≥—Ä—É–∑–∫—É –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –û—à–∏–±–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- –ó–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –≤ –∫—ç—à–µ
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ú–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- ‚úÖ Bearer —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ (UUID)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal –∞—Ç–∞–∫
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- –°—Ç—Ä–∏–º–∏–Ω–≥ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
- –ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- **CPU**: 2+ —è–¥—Ä–∞
- **RAM**: 512MB+ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤)
- **–î–∏—Å–∫**: SSD —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–°–µ—Ç—å**: 100Mbps+ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

## Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MAX_FILE_SIZE_MB`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

#### –§–∞–π–ª—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É cron job
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

#### –û—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç–∏ –≤ .env –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### –õ–æ–≥–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ Docker
docker logs micro-file-cache

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pnpm run start:dev
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

## Changelog

–°–º. [CHANGELOG.md](docs/CHANGELOG.md) –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
