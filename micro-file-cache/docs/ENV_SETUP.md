# Настройка переменных окружения

## Файлы конфигурации

В проекте доступны следующие файлы конфигурации:

- `env.example` - пример конфигурации с описанием всех переменных
- `env.dev` - готовая конфигурация для разработки с включенной аутентификацией

## Настройка для разработки

### 1. Создание файла .env

Скопируйте файл `env.dev` в `.env`:

```bash
cp env.dev .env
```

### 2. Настройка аутентификации

В файле `.env` уже настроена аутентификация для разработки:

```env
AUTH_ENABLED=true
AUTH_SECRET_KEY=dev-secret-key-for-micro-file-cache-12345678901234567890
```

### 3. Запуск приложения

После создания файла `.env` запустите приложение:

```bash
pnpm run start:dev
```

## Тестирование аутентификации

### Health endpoint (без аутентификации)

```bash
curl -X GET http://localhost:3000/api/v1/health
```

### Защищенные endpoints (требуют токен)

```bash
# Без токена (должен вернуть 401)
curl -X GET http://localhost:3000/api/v1/files

# С валидным токеном
curl -X GET http://localhost:3000/api/v1/files \
  -H "Authorization: Bearer dev-secret-key-for-micro-file-cache-12345678901234567890"
```

## Переменные окружения

### Основные настройки

- `NODE_ENV` - режим работы (по умолчанию: development)
- `LISTEN_HOST` - хост для прослушивания (по умолчанию: localhost)
- `LISTEN_PORT` - порт для прослушивания (по умолчанию: 3000)

### Аутентификация

- `AUTH_ENABLED` - включить/выключить аутентификацию (по умолчанию: true)
- `AUTH_SECRET_KEY` - секретный ключ для аутентификации (обязателен если AUTH_ENABLED=true, минимум 32 символа)

### Хранилище

- `STORAGE_PATH` - путь к директории хранилища (обязателен)
- `MAX_FILE_SIZE_MB` - максимальный размер файла в мегабайтах
- `ALLOWED_MIME_TYPES` - разрешенные MIME типы файлов (пустой массив = разрешены все типы)
- `ENABLE_DEDUPLICATION` - включить дедупликацию файлов (по умолчанию: true)

### TTL настройки

- `MAX_TTL_MIN` - максимальное время жизни файла в минутах (по умолчанию 60 минут)
- Минимальное время жизни файла фиксировано на 1 минуте (внутренняя константа)

### Очистка

- `CLEANUP_CRON` - cron выражение для расписания очистки
- `CLEANUP_INTERVAL_MIN` - интервал проверки в минутах (очистка всегда включена)

### Логирование

- `LOG_LEVEL` - уровень логирования (error/warn/info/debug/verbose)

## Безопасность

⚠️ **Важно**: В продакшене обязательно измените `AUTH_SECRET_KEY` на более сложный и безопасный ключ!

## Отключение аутентификации

Для отключения аутентификации в файле `.env` установите:

```env
AUTH_ENABLED=false
```

В этом случае все endpoints будут доступны без токена.
